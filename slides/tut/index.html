<!DOCTYPE html>
<html>
  <head>
    <title>Types vs Tests</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif', 'Helvetica'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz', 'Gill Sans';
        font-weight: normal;
      }
      .pull-left {
      float: left;
      width: 47%;
      }
      .pull-right {
      float: right;
      width: 47%;
      }
      table {
      border-collapse: collapse;
      display: inline-block;
      }
      th, td {
      padding: 10px;
      border: 1px solid black;
      }
      tr:nth-child(even) {background-color: #f2f2f2;}
      .large { font-size: 36px; }

      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono', 'Consolas', 'Courier New'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Types vs Tests
`@JulienTruffaut`

Code and slides at `julien-truffaut/types-vs-tests` on GitHub

---
class: center, middle

# Types

---
background-image: url(img/types-1.jpg)

# Types

---
background-image: url(img/types-2.jpg)

# Types

---
background-image: url(img/types-3.jpg)

# Types

---
# Types


.pull-left[
```tut:silent
val x: Int = 5
```


```tut:fail
val y: Int = false
```
]

--

.pull-right[
```tut:silent
def increment(x: Int): Int = x + 1
```

```tut
increment(2)
```


```tut:fail
increment("hello")
```

```tut:fail
def increment(x: Int): Int = x.toString
```
]

---
# Functional programming subset

.large[
* deterministic
* total
* no side effect
* no mutation
* no exception
* no null
* no reflection
]

---
class: center, middle

# Tests

---
class: center, middle

# Unit Tests

---
# Unit Tests

.center[
<br>

```tut:silent
assert(increment(0)  ==  1)
```

<br>

```tut:silent
assert(increment(1)  ==  2)
```

<br>

```tut:silent
assert(increment(-3) == -2)
```
]

---
background-image: url(img/increment-math-unit-test-1.jpg)

# Unit Tests

---
background-image: url(img/increment-math-unit-test-fail.jpg)

# Unit Tests

---
background-image: url(img/increment-math-unit-test-2.jpg)

# Unit Tests

---
class: center, middle

# Types and Tests

---

.pull-left[
# Types

```tut:fail
increment("hello")
```

```tut:fail
def increment(x: Int): Int = x.toString
```
]

.pull-right[
# Tests

```scala
assert(increment(0) == 2)

1 did not equal 2
ScalaTestFailureLocation: presentation.IncrementTest at (IncrementTest.scala:23)
Expected :2
Actual   :1
```
]

---
class: center, middle

# Both types and tests constrain the implementation of a function

---
class: center, middle

# How much?

---
class: center, middle

# A => B

---
class: center, middle

```tut:silent
val isEven: Int => Boolean =
  x => x % 2 == 0

val increment: Int => Int =
  x => x + 1
```

---
class: center, middle

# Type is a set

--

# &&

# Function has type

---
background-image: url(img/A-to-B-set-1.jpg)

# Type of a function is a set!

---
background-image: url(img/int-to-int-type-1.jpg)

Type of a function is a set!

---
background-image: url(img/int-to-int-type-test.jpg)

# Unit Tests

---
class: center, middle

# Valid Implementation Count (VIC)

---
class: center, middle

# VIC(f: A => B) = number of impl - impl invalid from tests

---
background-image: url(img/VIC-increment.jpg)

---
background-image: url(img/VIC-1.jpg)

.center[
# VIC(f) = 1
]

---
class: center, middle

# Valid Implementation Count (VIC)

# =

# How many impl pass the typechecker and my tests?

---
class: center, middle

# Valid Implementation Count (VIC)

# =

# How constrained is my function?

---
class: center, middle

# VIC(f: A => B) = <span style="color:blue">**number of impl**</span>  - impl invalid from tests

---
class: center, middle

# |f: A => B|

---
class: center, middle

# |A => B|

---
background-image: url(img/function.jpg)

# Function is a mapping

---
background-image: url(img/function-mapping-1.jpg)

# Function is a mapping

---
background-image: url(img/count-A-to-B-1.jpg)

# |A => B|

---
background-image: url(img/count-A-to-B-2.jpg)

# |A => B|

---
background-image: url(img/count-A-to-B-3.jpg)

# |A => B|

---
background-image: url(img/count-A-to-B-4.jpg)

# |A => B|

---
class: center, middle

```scala
|increment: Int => Int| = ?
```

---
class: center, middle

```scala
|Int => Int| = |Int| ^ |Int|
               = (2^32) ^ (2^32)
```

---
class: center, middle

```scala
|Int => Int| = |Int| ^ |Int|
               = (2^32) ^ (2^32)
                             =~ 41 billion digit long number
```

---
# Smaller Types

```tut:silent
sealed trait DayOfWeek

case object Monday  extends DayOfWeek
case object Tuesday extends DayOfWeek
// ...
case object Sunday  extends DayOfWeek
```

--

```scala
|DayOfWeek => Boolean| = |Boolean| ^ |DayOfWeek|
                       = 2 ^ 7
                       = 128
```

---
class: center, middle

# VIC(f: A => B) = number of impl - <span style="color:blue">**impl invalid from tests**</span>

---
background-image: url(img/day-week-to-boolean-1.jpg)

# How much a single unit test impacts VIC?

---
background-image: url(img/day-week-to-boolean-2.jpg)

# How much a single unit test impacts VIC?

---
# Unit Test

```scala
val f: DayOfWeek => Boolean = ???
```

such as

```scala
assert(isWeekend(Tuesday) == false)
```

---
background-image: url(img/count-day-week-to-boolean-1.jpg)

# Unit Test

---
background-image: url(img/count-day-week-to-boolean-2.jpg)

# Unit Test

---
background-image: url(img/count-day-week-to-boolean-3.jpg)

# Unit Test

---
background-image: url(img/count-day-week-to-boolean-4.jpg)

# Unit Test

---
# Unit Test

.center[
| # Unit tests | VIC  |
| :--------: |:----:|
| 0          | 128  |
| 1          | 64   |
| 2          | 32   |
| 3          | 16   |
| 4          |  8   |
| 5          |  4   |
| 6          |  2   |
| 7          |  1   |
]

---
class: center, middle

# `|A|` unit tests are required to have `VIC(f) = 1`

---
class: center, middle

# Every unit test divides VIC by |B|

---
# One Unit Test

.center[
```scala
VIC(f: A => B) = |B| ^ |A| / |B|
               = |B| ^ (|A| - 1)
```
]

--

# Two Unit Tests

.center[
```scala
VIC(f: A => B) = |B| ^ |A| / |B| / |B|
                 = (|B| ^ |A|) / (|B| ^ 2)
         = |B| ^ (|A| - 2)
```
]

---
class: center, middle

# `VIC(f: A => B) = |B| ^ (|A| - n)`

### where `n` is the number of unit tests

---
class: center, middle

```scala
VIC(increment) = |B| ^ (|A| - n)
                   = |Int| ^ (|Int| - n)
                       = (2 ^ 32) ^ (2 ^ 32 - n)
```

---
class: center, middle

# Logarithmic Valid Implementation Count (LVIC)

---
class: center, middle

# `LVIC(f) = Log_2 VIC(f)`

---
class: center, middle

```scala
LVIC(f: A => B) = Log_2 (|B| ^ (|A| - n))
              = (|A| - n) * Log_2 |B|
```

---
class: center, middle

```scala
LVIC(increment) = (|A| - n) * Log_2 |B|
          = 2 ^ 37 - 32 * n
                 =~ 137 billions - 32 * n
```

---
class: middle

## 1. Function types are sets

## 2. VIC and LVIC measure how constrained a function is

## 3. `VIC(f: A => B) = |B| ^ (|A| - n)`

## 4. VIC is reduced by using smaller types or more tests

## 5. Unit tests have a limited impact when |A| is big

---
# Example: dialCode

```tut:silent
def getDialCode(country: String): Option[Int] = ???
```

such as

```scala
assert(getDialCode("United Kingdom") == Some(44))
assert(getDialCode("France")         == Some(33))
assert(getDialCode("foo")            == None)
```

--

```scala
LVIC(getDialCode) = (|A| - n) * log_2 |B|
```

---

# Example: dialCode

```tut:silent
def getDialCode(country: String): Option[Int] = ???
```

such as

```scala
assert(getDialCode("United Kingdom") == Some(44))
assert(getDialCode("France")         == Some(33))
assert(getDialCode("foo")            == None)
```

```scala
LVIC(getDialCode) = (|A| - n) * log_2 |B|
                  = (|String| - 3) * log_2 |Option[Int]|
                  = (|String| - 3) * log_2 (|Int| + 1)
```

---
# Example: dialCode

```tut:silent
def getDialCode(country: String): Option[Int] = ???
```

such as

```scala
assert(getDialCode("United Kingdom") == Some(44))
assert(getDialCode("France")         == Some(33))
assert(getDialCode("foo")            == None)
```

```scala
LVIC(getDialCode) = (|A| - n) * log_2 |B|
                  = (|String| - 3) * log_2 |Option[Int]|
                  = (|String| - 3) * log_2 (|Int| + 1)
                  = (|String| - 3) * log_2 (2 ^ 32 + 1)
                  =~ |String| * 32
```

---
# Reduce VIC => Reduce Types

```scala
sealed trait Country

case object UnitedKingdom extends Country
case object France        extends Country
case object Italy         extends Country
case object Belgium       extends Country
...
case object China         extends Country
```

```tut:invisible
sealed trait Country

case object UnitedKingdom extends Country
case object France extends Country
case object Italy extends Country
case object Belgium extends Country
case object China extends Country
```

--

```tut:silent
def getDialCode_v2(country: Country): Int = ???
```

```scala
assert(getDialCode_v2(UnitedKingdom) == 44)
assert(getDialCode_v2(France)        == 33)
```

--

```tut:silent
def parseCountry(x: String): Option[Country] = ???
```

---
# Reduce VIC => Reduce Types

```tut:silent
def getDialCode_v2(country: Country): Int = ???
```

```scala
LVIC(getDialCode_v2) = (|Country| - 2) * log_2 |Int|
```

---
# Reduce VIC => Reduce Types

```tut:silent
def getDialCode_v2(country: Country): Int = ???
```

```scala
LVIC(getDialCode_v2) = (|Country| - 2) * log_2 |Int|
                     = (50 - 2) * log_2 2 ^ 32
                     = 48 * 32
                     = 1536
```

--

```tut:silent
def parseCountry(x: String): Option[Country] = ???
```

--

```scala
LVIC(parseCountry) =  (|String| - n) * log_2 |Option[Country]|
                   =  (|String| - n) * log_2 (|Country| + 1)
                   =  (|String| - n) * log_2 51
                   =~ |String| * 6
```

--

### Using Country reduced LVIC by a factor of 5!

---
# Example: Compare

```tut:silent
def compare(x: Char, y: Char): Int = {
  if(x < y)        -1
  else if (x == y)  0
  else              1
}
```

--

```scala
LVIC(compare) =  (|A| - n) * log_2 |B|
```

---
# Example: Compare

```tut:silent
def compare(x: Char, y: Char): Int = {
  if(x < y)        -1
  else if (x == y)  0
  else              1
}
```

```scala
LVIC(compare) =  (|A| - n) * log_2 |B|
              =  (|(Char, Char)| - n) * log_2 |Int|
              =  (2^16 - n) * log_2 2^32
              =  2^21 - 32 * n
              =~ 2 millions - 32 * n
```

---
# Example: Compare

```tut:silent
sealed trait Comparison

case object LowerThan   extends Comparison
case object EqualTo     extends Comparison
case object GreaterThan extends Comparison

def compare_v2(x: Char, y: Char): Comparison = {
  if(x < y)        LowerThan
  else if (x == y) EqualTo
  else             GreaterThan
}
```

--

```scala
LVIC(compare_v2) =  (|A| - n) * log_2 |B|
                 =  (|(Char, Char)| - n) * log_2 |Comparison|
                 =  (2^16 - n) * log_2 3
                 =~ 100 000 - 1.58 * n
```

--

### Using Comparison had the same impact on VIC than 60 000 unit tests!

---
class: center, middle

# Conclusion

---
# Advantages of VIC

## 1. Combine both types and test in a single metric

--

## 2. Can be automatically calculated

--

## 3. Make us realise how many incorrect implementations exist

---
# Disadvantages of VIC

## 1. Can easily reach extremely large number

--

## 2. Doesn't take into account the complexity of the implementation

--

## 3. Only support unit tests (no property based or integration tests)

--

## 4. Only support basic types (no parametric polymorphism, typeclasses or dependent types)

---
# Types > Unit Tests

.center.middle[
<br>
<br>
<br>
# `VIC(Any => Any) = |Any| ^ (|Any| - n)`

### where `n` is the number of unit tests
]

---
class: center, middle

# Thanks!
Code and slides at `julien-truffaut/types-vs-tests` on GitHub

<br>

Special thanks to Cesar Tron-Lozai and Maxim Ivanov


 </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
        var slideshow = remark.create({
            ratio: "16:9",
            slideNumberFormat: '%current%',
        });
    </script>
  </body>
</html>
