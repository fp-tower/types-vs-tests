<!DOCTYPE html>
<html>
  <head>
    <title>Types vs Tests</title>
    <meta charset="utf-8">
    <style>
      @import url(https://fonts.googleapis.com/css?family=Yanone+Kaffeesatz);
      @import url(https://fonts.googleapis.com/css?family=Droid+Serif:400,700,400italic);
      @import url(https://fonts.googleapis.com/css?family=Ubuntu+Mono:400,700,400italic);

      body { font-family: 'Droid Serif', 'Helvetica'; }
      h1, h2, h3 {
        font-family: 'Yanone Kaffeesatz', 'Gill Sans';
        font-weight: normal;
      }
      .pull-left {
      float: left;
      width: 47%;
      }
      .pull-right {
      float: right;
      width: 47%;
      }
      .remark-code, .remark-inline-code { font-family: 'Ubuntu Mono', 'Consolas', 'Courier New'; }
    </style>
  </head>
  <body>
    <textarea id="source">

class: center, middle

# Types vs Tests
`@JulienTruffaut`

---
class: center, middle

# Types

---
background-image: url(img/types-1.jpg)

# Types

---
background-image: url(img/types-2.jpg)

# Types

---
# Types


```tut:silent
val x: Int = 5

val foo: String = "Hello World"
```

--

```tut:fail
val x: Int = "Hello World"
```

---
background-image: url(img/function.jpg)

# Functions

---
# Functional programming subset

* not nondeterministic (deterministic)
* not partial (total)
* no side effect
* no mutation
* no exception
* no null
* no reflection

---
# Statically typed function

```tut:silent
def increment(x: Int): Int = x + 1
```

--

```tut
increment(2)
```

--

```tut:fail
increment(1.1)
increment("hello")
```

---
class: center, middle

# Tests

---
class: center, middle

# Unit Test

---
# Unit Test

```tut:silent
increment( 0) ==  1
increment( 1) ==  2
increment(-3) == -2
```

---
background-image: url(img/increment-math-unit-test-1.jpg)

# Unit Test

---
background-image: url(img/increment-math-unit-test-fail.jpg)

# Unit Test

---
background-image: url(img/increment-math-unit-test-2.jpg)

# Unit Test

---
class: center, middle

# Property Test

---
# Property Test

```tut:silent
import org.scalacheck.Prop.forAll

forAll { (x: Int) => increment(x) > x }
```

---
background-image: url(img/increment-math-property-test-1.jpg)
# Property Test

---
background-image: url(img/increment-math-property-test-2.jpg)
# Property Test

---
background-image: url(img/increment-math-property-test-fail.jpg)
# Property Test

---
background-image: url(img/increment-math-property-test-3.jpg)
# Property Test

---
class: center, middle

# Types and Tests?

---
# Untyped language (Javascript)

```javascript
function increment(x){
  return x + 1;
}
```

--

```javascript
increment(2)
3
```

--

```javascript
increment(1.1)
2.1
```

--

```javascript
increment("hello")
"hello1"
```

--

```javascript
increment('c')
"c1"
```

---
# Typed language (Scala)

```tut:silent
def increment(x: Int): Int = x + 1
```

--

```tut:fail
increment(1.1)
increment("hello")
```

---
class: center, middle

# Types constrain the implementation such as we have less tests to write

---
class: center, middle

# How much?

---
class: center, middle

# Are all types equals?

---
class: center, middle

# A => B

---
background-image: url(img/int-to-int-type-1.jpg)

# Functions have types!

---
background-image: url(img/int-to-int-type-2.jpg)

# Functions have types!

---
background-image: url(img/int-to-int-type-test-1.jpg)

# Unit test

---
background-image: url(img/int-to-int-type-test-2.jpg)

# Fully tested function

---
background-image: url(img/int-to-int-type-test-3.jpg)

# Compromise

---
background-image: url(img/function-one-value.jpg)

# Single value set

---
class: center, middle

# `Boolean => Unit`

---
class: center, middle

# |A => B| ?

---
background-image: url(img/function.jpg)

# Function is a mapping

---
background-image: url(img/function-mapping-1.jpg)

# Function is a mapping

---
background-image: url(img/count-A-to-B-1.jpg)

# |A => B|

---
background-image: url(img/count-A-to-B-2.jpg)

# |A => B|

---
background-image: url(img/count-A-to-B-3.jpg)

# |A => B|

---
background-image: url(img/count-A-to-B-4.jpg)

# |A => B|

---
class: center, middle

```scala
|Int => Int| = |Int| ^ |Int|
             = (2^32) ^ (2^32)
```

---
class: center, middle

# |A| ?

---
# Or

## `Boolean` is `true` **OR** `false`

--

## `Char` is `'a'` **OR** `'b'` **OR** ... **OR** `'!'` **OR** ...

--

## `DayOfTheWeek` is `Monday` **OR** `Tuesday` **OR** ...

--

## `Option[A]` is `None` **OR** a `Some[A]`

--

## `Either[E, A]` is a `Left[E]` **OR** a `Right[A]`


---
# Coproduct / Sum type

```scala
Foo is a Bar OR a Fizz

|Foo| = |Bar| + |Fizz|
```

--

```scala
|Boolean| = |true| + |false|
          = 1 + 1
          = 2
```

--

```scala
|Option[A]| = |None| + |Some[A]|
            = 1 + |A|
```

---
# And

## `LocalDate` is an `Int` (year) **AND** a `Short` (month) **AND** a `Short` (day)

--

## `Person` is a `String` (name) **AND** an `Int` (age)

--

## `(Int, String)` is an `Int` **AND** a `String`

---
# Product type

```scala
Foo is a Bar AND a Fizz

|Foo| = |Bar| * |Fizz|
```

--

```scala
|(Boolean, Char)| = |Boolean| * |Char|
                  = 2 * 256
                  = 512
```

--

```scala
|Person| = |String| * |Int|
```

---
class: center, middle

# Algebraic data type


---
# Example

```tut:silent
def isAdult(age: Int): Boolean = age >= 18
```

```tut
isAdult(25)
isAdult(18)
isAdult(5)
```

--

```tut
isAdult(-10)
```

---
# Example

```tut:silent
def isAdult(age: Int): Option[Boolean] = {
  if(age < 0) None
  else Some(age >= 18)
}
```

```tut
isAdult(25)
isAdult(18)
isAdult(5)
isAdult(-10)
```

---
background-image: url(img/isAdult-1.jpg)

# isAdult

---
background-image: url(img/isAdult-2.jpg)

# isAdult

---
# |isAdult|

```scala
|Int => Option[Boolean]| = |Option[Boolean]| ^ |Int|
                         = (1 + |Boolean|) ^ (2^32)
                         = 3 ^ (2^32)
```

```scala
|PosInt => Boolean| = |Boolean| ^ |Int / 2|
                    = 2 ^ (2^31)
```

---
# Refinement types

```tut:silent
import eu.timepit.refined._
import eu.timepit.refined.api.Refined
import eu.timepit.refined.auto._
import eu.timepit.refined.numeric._

type PosInt = Int Refined Positive

def isAdult(i: PosInt): Boolean = i.value >= 18
```

--

```tut
isAdult(5)
isAdult(22)
```

--


```tut:fail
isAdult(-2)
```


---
class: center, middle

# Thanks!
Code and slides at `julien-truffaut/types-vs-tests` on GitHub

## Questions?


 </textarea>
    <script src="https://remarkjs.com/downloads/remark-latest.min.js">
    </script>
    <script>
        var slideshow = remark.create({
            ratio: "16:9"
        });
    </script>
  </body>
</html>
